var g=Object.create;var a=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var T=(r,e)=>{for(var t in e)a(r,t,{get:e[t],enumerable:!0})},l=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of E(e))!I.call(r,n)&&n!==t&&a(r,n,{get:()=>e[n],enumerable:!(s=m(e,n))||s.enumerable});return r};var h=(r,e,t)=>(t=r!=null?g(p(r)):{},l(e||!r||!r.__esModule?a(t,"default",{value:r,enumerable:!0}):t,r)),y=r=>l(a({},"__esModule",{value:!0}),r);var w={};T(w,{HEADER_REMOTE_STORAGE_INSTANCE_ID:()=>d,HEADER_REMOTE_STORAGE_USER_ID:()=>x,RemoteStorage:()=>i});module.exports=y(w);var f=h(require("cross-fetch"),1);function c(){let r=new Date().getTime(),e=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let s=Math.random()*16;return r>0?(s=(r+s)%16|0,r=Math.floor(r/16)):(s=(e+s)%16|0,e=Math.floor(e/16)),(t=="x"?s:s&7|8).toString(16)})}function o(){return typeof window<"u"}var d="x-remote-storage-instance-id",x="x-remote-storage-user-id";var u="/entities/",i=class{constructor(e){let{serverAddress:t,instanceId:s,userId:n}=e??{};this.serverAddress=t??"https://api.remote.storage",this.instanceId=s??"default",this.userId=n??this.getUserId()}async getItem(e,t){let s=await this.call("GET",`${u}${e}`,t,null);if(s.status===404)return null;let n=await s.text();return!n.startsWith("{")&&!n.startsWith("[")?n==="true"?!0:n==="false"?!1:isNaN(Number(n))?n:Number(n):JSON.parse(n)}async setItem(e,t,s){await this.call("PUT",`${u}${e}`,s,t)}async removeItem(e,t){await this.call("DELETE",`${u}${e}`,t,null)}async call(e,t,s,n){return(0,f.default)(new URL(t,this.serverAddress).toString(),{method:e,headers:{"Content-Type":"application/json",[d]:this.instanceId,[x]:this.userId,...s==null?void 0:s.headers},body:n?JSON.stringify(n):void 0})}getUserId(){let e="rs-user-id";if(o()&&window.localStorage.getItem(e))return window.localStorage.getItem(e);let t=c();return o()&&window.localStorage.setItem(e,t),t}};globalThis.RemoteStorage=i;0&&(module.exports={HEADER_REMOTE_STORAGE_INSTANCE_ID,HEADER_REMOTE_STORAGE_USER_ID,RemoteStorage});
//# sourceMappingURL=index.cjs.map