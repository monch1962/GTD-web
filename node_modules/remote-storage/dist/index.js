import l from"cross-fetch";function d(){let n=new Date().getTime(),e=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let t=Math.random()*16;return n>0?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(e+t)%16|0,e=Math.floor(e/16)),(r=="x"?t:t&7|8).toString(16)})}function a(){return typeof window<"u"}var x="x-remote-storage-instance-id",u="x-remote-storage-user-id";var o="/entities/",i=class{constructor(e){let{serverAddress:r,instanceId:t,userId:s}=e??{};this.serverAddress=r??"https://api.remote.storage",this.instanceId=t??"default",this.userId=s??this.getUserId()}async getItem(e,r){let t=await this.call("GET",`${o}${e}`,r,null);if(t.status===404)return null;let s=await t.text();return!s.startsWith("{")&&!s.startsWith("[")?s==="true"?!0:s==="false"?!1:isNaN(Number(s))?s:Number(s):JSON.parse(s)}async setItem(e,r,t){await this.call("PUT",`${o}${e}`,t,r)}async removeItem(e,r){await this.call("DELETE",`${o}${e}`,r,null)}async call(e,r,t,s){return l(new URL(r,this.serverAddress).toString(),{method:e,headers:{"Content-Type":"application/json",[x]:this.instanceId,[u]:this.userId,...t==null?void 0:t.headers},body:s?JSON.stringify(s):void 0})}getUserId(){let e="rs-user-id";if(a()&&window.localStorage.getItem(e))return window.localStorage.getItem(e);let r=d();return a()&&window.localStorage.setItem(e,r),r}};globalThis.RemoteStorage=i;export{x as HEADER_REMOTE_STORAGE_INSTANCE_ID,u as HEADER_REMOTE_STORAGE_USER_ID,i as RemoteStorage};
//# sourceMappingURL=index.js.map