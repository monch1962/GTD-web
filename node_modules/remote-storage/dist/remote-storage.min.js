(()=>{var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames,__getOwnPropSymbols=Object.getOwnPropertySymbols,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a};var __commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(let key of __getOwnPropNames(from))!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod));var __publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);var require_browser_ponyfill=__commonJS({"../../node_modules/.pnpm/cross-fetch@4.0.0/node_modules/cross-fetch/dist/browser-ponyfill.js"(exports,module){var __global__=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global,__globalThis__=function(){function F(){this.fetch=!1,this.DOMException=__global__.DOMException}return F.prototype=__global__,new F}();(function(globalThis2){var irrelevant=function(exports2){var global2=typeof globalThis2<"u"&&globalThis2||typeof self<"u"&&self||typeof global2<"u"&&global2,support={searchParams:"URLSearchParams"in global2,iterable:"Symbol"in global2&&"iterator"in Symbol,blob:"FileReader"in global2&&"Blob"in global2&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in global2,arrayBuffer:"ArrayBuffer"in global2};function isDataView(obj){return obj&&DataView.prototype.isPrototypeOf(obj)}if(support.arrayBuffer)var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1};function normalizeName(name){if(typeof name!="string"&&(name=String(name)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(name)||name==="")throw new TypeError('Invalid character in header field name: "'+name+'"');return name.toLowerCase()}function normalizeValue(value){return typeof value!="string"&&(value=String(value)),value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:value===void 0,value}}};return support.iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator}function Headers(headers){this.map={},headers instanceof Headers?headers.forEach(function(value,name){this.append(name,value)},this):Array.isArray(headers)?headers.forEach(function(header){this.append(header[0],header[1])},this):headers&&Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name])},this)}Headers.prototype.append=function(name,value){name=normalizeName(name),value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+", "+value:value},Headers.prototype.delete=function(name){delete this.map[normalizeName(name)]},Headers.prototype.get=function(name){return name=normalizeName(name),this.has(name)?this.map[name]:null},Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))},Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)},Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map)this.map.hasOwnProperty(name)&&callback.call(thisArg,this.map[name],name,this)},Headers.prototype.keys=function(){var items=[];return this.forEach(function(value,name){items.push(name)}),iteratorFor(items)},Headers.prototype.values=function(){var items=[];return this.forEach(function(value){items.push(value)}),iteratorFor(items)},Headers.prototype.entries=function(){var items=[];return this.forEach(function(value,name){items.push([name,value])}),iteratorFor(items)},support.iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);function consumed(body){if(body.bodyUsed)return Promise.reject(new TypeError("Already read"));body.bodyUsed=!0}function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)},reader.onerror=function(){reject(reader.error)}})}function readBlobAsArrayBuffer(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsArrayBuffer(blob),promise}function readBlobAsText(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsText(blob),promise}function readArrayBufferAsText(buf){for(var view=new Uint8Array(buf),chars=new Array(view.length),i=0;i<view.length;i++)chars[i]=String.fromCharCode(view[i]);return chars.join("")}function bufferClone(buf){if(buf.slice)return buf.slice(0);var view=new Uint8Array(buf.byteLength);return view.set(new Uint8Array(buf)),view.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(body){this.bodyUsed=this.bodyUsed,this._bodyInit=body,body?typeof body=="string"?this._bodyText=body:support.blob&&Blob.prototype.isPrototypeOf(body)?this._bodyBlob=body:support.formData&&FormData.prototype.isPrototypeOf(body)?this._bodyFormData=body:support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)?this._bodyText=body.toString():support.arrayBuffer&&support.blob&&isDataView(body)?(this._bodyArrayBuffer=bufferClone(body.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))?this._bodyArrayBuffer=bufferClone(body):this._bodyText=body=Object.prototype.toString.call(body):this._bodyText="",this.headers.get("content-type")||(typeof body=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support.blob&&(this.blob=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var isConsumed=consumed(this);return isConsumed||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return readBlobAsText(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support.formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}function Request(input,options){if(!(this instanceof Request))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');options=options||{};var body=options.body;if(input instanceof Request){if(input.bodyUsed)throw new TypeError("Already read");this.url=input.url,this.credentials=input.credentials,options.headers||(this.headers=new Headers(input.headers)),this.method=input.method,this.mode=input.mode,this.signal=input.signal,!body&&input._bodyInit!=null&&(body=input._bodyInit,input.bodyUsed=!0)}else this.url=String(input);if(this.credentials=options.credentials||this.credentials||"same-origin",(options.headers||!this.headers)&&(this.headers=new Headers(options.headers)),this.method=normalizeMethod(options.method||this.method||"GET"),this.mode=options.mode||this.mode||null,this.signal=options.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&body)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(body),(this.method==="GET"||this.method==="HEAD")&&(options.cache==="no-store"||options.cache==="no-cache")){var reParamSearch=/([?&])_=[^&]*/;if(reParamSearch.test(this.url))this.url=this.url.replace(reParamSearch,"$1_="+new Date().getTime());else{var reQueryString=/\?/;this.url+=(reQueryString.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})};function decode(body){var form=new FormData;return body.trim().split("&").forEach(function(bytes){if(bytes){var split=bytes.split("="),name=split.shift().replace(/\+/g," "),value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}}),form}function parseHeaders(rawHeaders){var headers=new Headers,preProcessedHeaders=rawHeaders.replace(/\r?\n[\t ]+/g," ");return preProcessedHeaders.split("\r").map(function(header){return header.indexOf(`
`)===0?header.substr(1,header.length):header}).forEach(function(line){var parts=line.split(":"),key=parts.shift().trim();if(key){var value=parts.join(":").trim();headers.append(key,value)}}),headers}Body.call(Request.prototype);function Response(bodyInit,options){if(!(this instanceof Response))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');options||(options={}),this.type="default",this.status=options.status===void 0?200:options.status,this.ok=this.status>=200&&this.status<300,this.statusText=options.statusText===void 0?"":""+options.statusText,this.headers=new Headers(options.headers),this.url=options.url||"",this._initBody(bodyInit)}Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var response=new Response(null,{status:0,statusText:""});return response.type="error",response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(redirectStatuses.indexOf(status)===-1)throw new RangeError("Invalid status code");return new Response(null,{status,headers:{location:url}})},exports2.DOMException=global2.DOMException;try{new exports2.DOMException}catch(err){exports2.DOMException=function(message,name){this.message=message,this.name=name;var error=Error(message);this.stack=error.stack},exports2.DOMException.prototype=Object.create(Error.prototype),exports2.DOMException.prototype.constructor=exports2.DOMException}function fetch2(input,init){return new Promise(function(resolve,reject){var request=new Request(input,init);if(request.signal&&request.signal.aborted)return reject(new exports2.DOMException("Aborted","AbortError"));var xhr=new XMLHttpRequest;function abortXhr(){xhr.abort()}xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||"")};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;setTimeout(function(){resolve(new Response(body,options))},0)},xhr.onerror=function(){setTimeout(function(){reject(new TypeError("Network request failed"))},0)},xhr.ontimeout=function(){setTimeout(function(){reject(new TypeError("Network request failed"))},0)},xhr.onabort=function(){setTimeout(function(){reject(new exports2.DOMException("Aborted","AbortError"))},0)};function fixUrl(url){try{return url===""&&global2.location.href?global2.location.href:url}catch(e){return url}}xhr.open(request.method,fixUrl(request.url),!0),request.credentials==="include"?xhr.withCredentials=!0:request.credentials==="omit"&&(xhr.withCredentials=!1),"responseType"in xhr&&(support.blob?xhr.responseType="blob":support.arrayBuffer&&request.headers.get("Content-Type")&&request.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(xhr.responseType="arraybuffer")),init&&typeof init.headers=="object"&&!(init.headers instanceof Headers)?Object.getOwnPropertyNames(init.headers).forEach(function(name){xhr.setRequestHeader(name,normalizeValue(init.headers[name]))}):request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)}),request.signal&&(request.signal.addEventListener("abort",abortXhr),xhr.onreadystatechange=function(){xhr.readyState===4&&request.signal.removeEventListener("abort",abortXhr)}),xhr.send(typeof request._bodyInit>"u"?null:request._bodyInit)})}return fetch2.polyfill=!0,global2.fetch||(global2.fetch=fetch2,global2.Headers=Headers,global2.Request=Request,global2.Response=Response),exports2.Headers=Headers,exports2.Request=Request,exports2.Response=Response,exports2.fetch=fetch2,exports2}({})})(__globalThis__);__globalThis__.fetch.ponyfill=!0;delete __globalThis__.fetch.polyfill;var ctx=__global__.fetch?__global__:__globalThis__;exports=ctx.fetch;exports.default=ctx.fetch;exports.fetch=ctx.fetch;exports.Headers=ctx.Headers;exports.Request=ctx.Request;exports.Response=ctx.Response;module.exports=exports}});var import_cross_fetch=__toESM(require_browser_ponyfill(),1);function uuid(){let d=new Date().getTime(),d2=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{let r=Math.random()*16;return d>0?(r=(d+r)%16|0,d=Math.floor(d/16)):(r=(d2+r)%16|0,d2=Math.floor(d2/16)),(c=="x"?r:r&7|8).toString(16)})}function isWeb(){return typeof window<"u"}var HEADER_REMOTE_STORAGE_INSTANCE_ID="x-remote-storage-instance-id",HEADER_REMOTE_STORAGE_USER_ID="x-remote-storage-user-id";var apiPrefix="/entities/",RemoteStorage=class{constructor(config){__publicField(this,"serverAddress");__publicField(this,"instanceId");__publicField(this,"userId");let{serverAddress,instanceId,userId}=config!=null?config:{};this.serverAddress=serverAddress!=null?serverAddress:"https://api.remote.storage",this.instanceId=instanceId!=null?instanceId:"default",this.userId=userId!=null?userId:this.getUserId()}async getItem(key,fetchOptions){let response=await this.call("GET",`${apiPrefix}${key}`,fetchOptions,null);if(response.status===404)return null;let data=await response.text();return!data.startsWith("{")&&!data.startsWith("[")?data==="true"?!0:data==="false"?!1:isNaN(Number(data))?data:Number(data):JSON.parse(data)}async setItem(key,value,fetchOptions){await this.call("PUT",`${apiPrefix}${key}`,fetchOptions,value)}async removeItem(key,fetchOptions){await this.call("DELETE",`${apiPrefix}${key}`,fetchOptions,null)}async call(method,path,options,data){return(0,import_cross_fetch.default)(new URL(path,this.serverAddress).toString(),{method,headers:__spreadValues({"Content-Type":"application/json",[HEADER_REMOTE_STORAGE_INSTANCE_ID]:this.instanceId,[HEADER_REMOTE_STORAGE_USER_ID]:this.userId},options==null?void 0:options.headers),body:data?JSON.stringify(data):void 0})}getUserId(){let key="rs-user-id";if(isWeb()&&window.localStorage.getItem(key))return window.localStorage.getItem(key);let userId=uuid();return isWeb()&&window.localStorage.setItem(key,userId),userId}};globalThis.RemoteStorage=RemoteStorage;})();
