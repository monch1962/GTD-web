<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTD Web - Getting Things Done</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1><i class="fas fa-check-circle"></i> GTD Web</h1>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <a href="#" class="nav-item active" data-view="inbox">
                        <i class="fas fa-inbox"></i>
                        <span>Inbox</span>
                        <span class="count" id="inbox-count">0</span>
                    </a>
                    <a href="#" class="nav-item" data-view="next">
                        <i class="fas fa-bolt"></i>
                        <span>Next Actions</span>
                        <span class="count" id="next-count">0</span>
                    </a>
                    <a href="#" class="nav-item" data-view="waiting">
                        <i class="fas fa-clock"></i>
                        <span>Waiting For</span>
                        <span class="count" id="waiting-count">0</span>
                    </a>
                    <a href="#" class="nav-item" data-view="someday">
                        <i class="fas fa-cloud"></i>
                        <span>Someday/Maybe</span>
                        <span class="count" id="someday-count">0</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-item projects-dropdown-toggle">
                        <i class="fas fa-folder"></i>
                        <span>Projects</span>
                        <span class="count" id="projects-count">0</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </div>
                    <div class="projects-dropdown" id="projects-dropdown">
                        <!-- Projects will be dynamically added here -->
                    </div>
                    <a href="#" class="nav-item" data-view="reference">
                        <i class="fas fa-book"></i>
                        <span>Reference</span>
                        <span class="count" id="reference-count">0</span>
                    </a>
                </div>

                <div class="nav-section">
                    <a href="#" class="nav-item" data-view="all">
                        <i class="fas fa-list"></i>
                        <span>All Items</span>
                    </a>
                    <a href="#" class="nav-item" id="help-button">
                        <i class="fas fa-question-circle"></i>
                        <span>Help</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info" id="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="user-id">Loading...</span>
                </div>
                <button id="sync-status" class="sync-button">
                    <i class="fas fa-sync"></i>
                    <span class="sync-text">Synced</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h2 id="view-title">Inbox</h2>
                <div class="filters">
                    <select id="context-filter" class="filter-select">
                        <option value="">All Contexts</option>
                    </select>
                    <select id="energy-filter" class="filter-select">
                        <option value="">Any Energy</option>
                        <option value="high">High Energy</option>
                        <option value="medium">Medium Energy</option>
                        <option value="low">Low Energy</option>
                    </select>
                    <select id="time-filter" class="filter-select">
                        <option value="">Any Time</option>
                        <option value="5">5 minutes</option>
                        <option value="15">15 minutes</option>
                        <option value="30">30 minutes</option>
                        <option value="60">1 hour</option>
                        <option value="120">2+ hours</option>
                    </select>
                </div>
            </header>

            <div class="quick-add">
                <input type="text" id="quick-add-input" placeholder="Quick add... (Press Enter to add)">
                <div class="quick-contexts">
                    <span class="quick-context-label">Quick tags:</span>
                    <button class="quick-context" data-context="@home">@home</button>
                    <button class="quick-context" data-context="@work">@work</button>
                    <button class="quick-context" data-context="@personal">@personal</button>
                    <button class="quick-context" data-context="@computer">@computer</button>
                    <button class="quick-context" data-context="@phone">@phone</button>
                    <button class="btn-create-context" id="btn-create-context">
                        <i class="fas fa-plus"></i> Create Context
                    </button>
                </div>
            </div>

            <div id="tasks-container" class="tasks-container">
                <!-- Tasks will be rendered here -->
            </div>

            <div id="projects-container" class="projects-container" style="display: none;">
                <!-- Projects will be rendered here -->
            </div>

            <div id="reference-container" class="reference-container" style="display: none;">
                <!-- Reference items will be rendered here -->
            </div>
        </main>

        <!-- Task/Edit Modal -->
        <div id="task-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Add Task</h3>
                    <button class="close-button" id="close-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="task-form" class="task-form">
                    <input type="hidden" id="task-id">

                    <div class="form-group">
                        <label for="task-title">Title *</label>
                        <input type="text" id="task-title" required>
                    </div>

                    <div class="form-group">
                        <label for="task-description">Description</label>
                        <textarea id="task-description" rows="3"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-type">Type</label>
                            <select id="task-type">
                                <option value="task">Task</option>
                                <option value="project">Project</option>
                                <option value="reference">Reference</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="task-status">Status</label>
                            <select id="task-status">
                                <option value="inbox">Inbox</option>
                                <option value="next">Next Action</option>
                                <option value="waiting">Waiting For</option>
                                <option value="someday">Someday/Maybe</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-energy">Energy Required</label>
                            <select id="task-energy">
                                <option value="">None</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="task-time">Time Required (min)</label>
                            <input type="number" id="task-time" min="0" step="5" placeholder="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="task-project">Project</label>
                        <select id="task-project">
                            <option value="">No Project</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-due-date">Due Date</label>
                            <input type="date" id="task-due-date">
                        </div>

                        <div class="form-group">
                            <label for="task-defer-date">Defer Date</label>
                            <input type="date" id="task-defer-date">
                        </div>
                    </div>

                    <div class="form-group" id="waiting-for-section" style="display: none;">
                        <label for="task-waiting-for-description">Waiting For Description</label>
                        <input type="text" id="task-waiting-for-description" placeholder="e.g., Response from John, Design team approval">
                        <small style="color: var(--text-secondary);">What/who are you waiting for?</small>
                    </div>

                    <div class="form-group" id="waiting-for-deps-section" style="display: none;">
                        <label for="task-waiting-for-tasks">Waiting For (Task Dependencies)</label>
                        <div id="waiting-for-tasks-list" style="max-height: 150px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--radius-sm); padding: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">No task dependencies selected</p>
                        </div>
                        <small style="color: var(--text-secondary);">Select tasks that must be completed before this task becomes actionable</small>
                    </div>

                    <div class="form-group">
                        <label for="task-contexts">Contexts (comma separated)</label>
                        <input type="text" id="task-contexts" placeholder="@home, @computer, important">
                        <div class="quick-contexts-modal">
                            <button class="quick-context-modal" data-context="@home">@home</button>
                            <button class="quick-context-modal" data-context="@work">@work</button>
                            <button class="quick-context-modal" data-context="@personal">@personal</button>
                            <button class="quick-context-modal" data-context="@computer">@computer</button>
                            <button class="quick-context-modal" data-context="@phone">@phone</button>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <button type="button" class="btn btn-secondary" id="cancel-modal">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Project Modal -->
        <div id="project-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="project-modal-title">Add Project</h3>
                    <button class="close-button" id="close-project-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="project-form" class="task-form">
                    <input type="hidden" id="project-id">

                    <div class="form-group">
                        <label for="project-title">Title *</label>
                        <input type="text" id="project-title" required>
                    </div>

                    <div class="form-group">
                        <label for="project-description">Description</label>
                        <textarea id="project-description" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="project-status">Status</label>
                        <select id="project-status">
                            <option value="active">Active</option>
                            <option value="someday">Someday/Maybe</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="project-contexts">Contexts (comma separated)</label>
                        <input type="text" id="project-contexts" placeholder="work, personal">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <button type="button" class="btn btn-secondary" id="cancel-project-modal">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Context Creation Modal -->
    <div id="context-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="context-modal-title">Create New Context</h3>
                <button class="close-button" id="close-context-modal">&times;</button>
            </div>
            <form id="context-form" class="task-form">
                <div class="form-group">
                    <label for="context-name">Context Name *</label>
                    <input type="text" id="context-name" required placeholder="e.g., urgent, review, priority">
                    <small style="color: var(--text-secondary); margin-top: 4px; display: block;">
                        Tip: Use @ for context tags (e.g., @errands) or plain text for categories
                    </small>
                </div>

                <div id="context-error" style="color: var(--danger-color); display: none; margin-bottom: 1rem;"></div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Create Context
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancel-context-modal">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>GTD Web - Help & Instructions</h3>
                <button class="close-button" id="close-help-modal">&times;</button>
            </div>
            <div class="help-content" style="padding: var(--spacing-lg);">
                <h4>Getting Started with GTD</h4>
                <p>Welcome to GTD Web! This app implements David Allen's Getting Things Done methodology to help you stay organized and productive.</p>

                <h5>Core Concepts</h5>
                <ul>
                    <li><strong>Inbox</strong> - Quick capture for all new tasks and ideas. Process these regularly.</li>
                    <li><strong>Next Actions</strong> - Actionable tasks you can do right now.</li>
                    <li><strong>Waiting For</strong> - Tasks you're waiting on someone/something else for.</li>
                    <li><strong>Someday/Maybe</strong> - Tasks you might do later, but not now.</li>
                    <li><strong>Projects</strong> - Multi-step outcomes that require multiple tasks.</li>
                    <li><strong>Reference</strong> - Non-actionable information you want to keep.</li>
                </ul>

                <h5>Creating Tasks</h5>
                <ol>
                    <li><strong>Quick Add</strong> - Type in the input box and press Enter for fast capture</li>
                    <li><strong>Detailed Add</strong> - Click "Add Task" button for full details</li>
                    <li>Set status, energy level, time estimates, due dates, and defer dates</li>
                    <li>Assign to projects and add tags</li>
                </ol>

                <h5>Managing Projects</h5>
                <ol>
                    <li>Go to "Projects" view</li>
                    <li>Click "Add Project" button</li>
                    <li>Enter title, description, and tags</li>
                    <li>Assign tasks to projects when creating/editing them</li>
                    <li><strong>Note:</strong> When you assign an Inbox task to a project, it automatically moves to Next Actions</li>
                </ol>

                <h5>Using Contexts</h5>
                <ul>
                    <li><strong>Default Contexts:</strong> @home, @work, @personal, @computer, @phone</li>
                    <li><strong>Custom Contexts:</strong> Click the green "Create Context" button to make your own</li>
                    <li><strong>Delete Contexts:</strong> Click the Ã— button on custom tags to delete them (removes from all tasks/projects)</li>
                    <li>Click context buttons to quickly add them to tasks</li>
                    <li>Use the context filter in the header to filter tasks by context</li>
                </ul>

                <h5>Task Dependencies (Waiting For)</h5>
                <ol>
                    <li>Create or edit a task</li>
                    <li>Set status to "Waiting For"</li>
                    <li><strong>Description:</strong> What/who are you waiting for? (e.g., "Response from John")</li>
                    <li><strong>Dependencies:</strong> Select tasks that must complete first</li>
                    <li>When dependencies are met, tasks automatically move to Next Actions!</li>
                </ol>

                <h5>Dates & Deadlines</h5>
                <ul>
                    <li><strong>Due Date</strong> - When a task must be done. Overdue tasks show in red.</li>
                    <li><strong>Defer Date</strong> - Hide a task until this date (great for future tasks)</li>
                    <li>Tasks with defer dates won't show in Next Actions until the date arrives</li>
                </ul>

                <h5>Filtering Tasks</h5>
                <ul>
                    <li><strong>Context Filter</strong> - Filter by any context</li>
                    <li><strong>Energy Filter</strong> - Find tasks matching your energy level</li>
                    <li><strong>Time Filter</strong> - Find tasks that fit your available time</li>
                    <li>Filters work together for powerful task discovery</li>
                </ul>

                <h5>Workflow Tips</h5>
                <ol>
                    <li><strong>Capture Everything</strong> - Don't trust your memory, use the Inbox</li>
                    <li><strong>Process Inbox Daily</strong> - Decide what each item means and where it goes</li>
                    <li><strong>Review Weekly</strong> - Check all projects, waiting items, and someday/maybe tasks</li>
                    <li><strong>Do by Context</strong> - Use tags to filter by @home, @work, @computer, etc.</li>
                    <li><strong>Match Energy</strong> - Use the energy filter when tired or energized</li>
                </ol>

                <h5>Keyboard Shortcuts</h5>
                <ul>
                    <li><strong>Enter</strong> - Quick add task (in quick input field)</li>
                    <li><strong>Escape</strong> - Close modals</li>
                </ul>

                <h5>Data Storage</h5>
                <p>All data is stored locally in your browser's localStorage. Your tasks stay private on your device. Clearing browser data will delete your tasks, so consider backing up regularly.</p>
            </div>
        </div>
    </div>

    <!-- Gantt Chart Modal -->
    <div id="gantt-modal" class="modal">
        <div class="modal-content" style="max-width: 90%; width: 1400px;">
            <div class="modal-header">
                <h3 id="gantt-modal-title">Project Gantt Chart</h3>
                <button class="close-button" id="close-gantt-modal">&times;</button>
            </div>
            <div class="gantt-container" id="gantt-chart">
                <!-- Gantt chart will be rendered here -->
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
